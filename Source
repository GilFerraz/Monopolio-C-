/*
Copyright 2014-2015, Gil Ferraz e Teresa Loureiro
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

//Estrutura de dados para o registo de Propriedades
typedef struct registoPropriedades
{
	char nome[50];
	int preço;
	int hipoteca;
	char localizaçao[50];
	char proprietario[20];
} Propriedade;

Propriedade propriedades[39];

//Estrutura de dados para o registo de Jogadores
typedef struct registoJogadores
{
	char nome[50];
	int saldo;
	int posição;
} Jogador;

Jogador jogadores[8];

//Cadeia
bool cadeia()
{
	printf("Necessita de fazer um double para sair da cadeia.");
	int dado1, dado2, total;

	dado1 = (rand() % 6) + 1;
	dado2 = (rand() % 6) + 1;
	total = dado1 + dado2;
	if (dado1 == dado2)
	{
		printf("Saiu da cadeia!");
		return false;
	}
	else return true;
}

//Lançamento de dois dados
int lançamentoDados()
{
	int dado1 = (rand() % 6) + 1;
	int dado2 = (rand() % 6) + 1;
	int total1 = dado1 + dado2;
	printf("\n== 1 - Lançamento de Dados ==\n");
	printf(" * Primeiro Lancamento: %d + %d = %d casas\n", dado1, dado2, total1);

	if (dado1 != dado2)
	{
		printf("\nAvance %d casas.\n", total1);
		return (total1);
	}
	else
	{
		printf(" DOUBLE!\n\n");
		dado1 = (rand() % 6) + 1;
		dado2 = (rand() % 6) + 1;
		int total2 = dado1 + dado2;
		printf(" * Segundo Lancamento: %d + %d = %d casas\n", dado1, dado2, total2);

		if (dado1 != dado2)
		{
			printf("\nAvance %d casas.\n", total1 + total2);
			return (total1 + total2);
		}
		else
		{
			printf(" DOUBLE!\n\n");
			dado1 = (rand() % 6) + 1;
			dado2 = (rand() % 6) + 1;
			int total3 = dado1 + dado2;
			printf(" * Terceiro Lancamento: %d + %d = %d casas\n", dado1, dado2, total3);

			if (dado1 != dado2)
			{
				printf("\nAvance %d casas.\n", total1 + total2 + total3);
				return (total1 + total2 + total3);
			}
			else
			{
				printf("Obteve 3 DOUBLES consecutivos. Vai para a cadeia!\n");
				cadeia();
			}
		}
	}
}

//Seleção de Jogoadoes
int seleçãoJogadores()
{
	int nJogadores;

	printf("Qual e o numero de jogadores (2 a 8): ");
	scanf_s("%d", &nJogadores);
	printf("\n");

	while ((nJogadores < 2) || (nJogadores > 8))
	{
		printf("ERRO! %d nao e um numero de jogadores valido.\n", nJogadores);
		printf("Qual e o numero de jogadores (2 a 8): ");
		scanf_s("%d", &nJogadores);
	}
	getchar();
	for (int i = 0; i < nJogadores; i++)
	{
		printf("Qual e o nome do jogador %d: ", i + 1);
		/*scanf_s("%c", jogadores[i].nome)*/
		gets_s(jogadores[i].nome, 50);
		jogadores[i].saldo = 1500;
		jogadores[i].posição = 0;
	}
	return (nJogadores);
}

//Calcula a nova posição do Jogador após o Lançamento dos Dados
int novaPosicao(int posActual, int lancamentoDados)
{
	int novaPos = posActual + lancamentoDados;

	if (novaPos == 40)
	{
		novaPos = 0;
		return (novaPos);
	}
	else if (novaPos > 40) return(novaPos - 40);
	else return novaPos;
}

void main()
{
	// == Definição de Casas e Propriedades ==
	//Casa 0 - Partida
	strcpy(propriedades[0].nome, "Inicio");
	propriedades[0].preço = 0;
	propriedades[0].hipoteca = 0;
	strcpy(propriedades[0].localizaçao, " ");
	strcpy(propriedades[0].proprietario, "Interdito");

	//Casa 1
	strcpy(propriedades[1].nome, "Campo Grande");
	propriedades[1].preço = 60;
	propriedades[1].hipoteca = 5;
	strcpy(propriedades[1].localizaçao, "Lisboa");
	strcpy(propriedades[1].proprietario, "Sem Proprietario");

	//Casa 2
	strcpy(propriedades[2].nome,"Rua Faria Guimaraes");
	propriedades[2].preço = 60;
	propriedades[2].hipoteca = 5;
	strcpy(propriedades[2].localizaçao,"Porto");
	strcpy(propriedades[2].proprietario,"Sem Proprietario");

	//Casa 3 - Pague imposto sobre capitais 200$

	
	//Casa 4
	strcpy(propriedades[4].nome, "Estacao do Rossio");
	propriedades[4].preço = 200;
	propriedades[4].hipoteca = 50;
	strcpy(propriedades[4].localizaçao, "Lisboa");
	strcpy(propriedades[4].proprietario, "Sem Proprietario");

	//Casa 5
	strcpy(propriedades[5].nome, "Alamedas das Linhas de Torres");
	propriedades[5].preço = 100;
	propriedades[5].hipoteca = 50;
	strcpy(propriedades[5].localizaçao, "Lisboa");
	strcpy(propriedades[5].proprietario, "Sem Proprietario");
	
	//Casa 6 - Sorte


	//Casa 7
	strcpy(propriedades[7].nome, "Avenida das Nacoes Unidas");
	propriedades[7].preço = 100;
	propriedades[7].hipoteca = 50;
	strcpy(propriedades[7].localizaçao, "Lisboa");
	strcpy(propriedades[7].proprietario, "Sem Proprietario");

	//Casa 8
	strcpy(propriedades[8].nome, "Avenida 24 de Julho");
	propriedades[8].preço = 120;
	propriedades[8].hipoteca = 50;
	strcpy(propriedades[8].localizaçao, "Lisboa");
	strcpy(propriedades[8].proprietario, "Sem Proprietario");

	//Casa 9 - Cadeia
	strcpy(propriedades[8].nome, "Cadeia");
	propriedades[8].preço = 0;
	propriedades[8].hipoteca = 0;
	strcpy(propriedades[8].localizaçao, " ");
	strcpy(propriedades[8].proprietario, "Interdito");

	//Casa 10
	strcpy(propriedades[10].nome, "Avenida Central");
	propriedades[10].preço = 140;
	propriedades[10].hipoteca = 50;
	strcpy(propriedades[10].localizaçao, "Braga");
	strcpy(propriedades[10].proprietario, "Sem Proprietario");

	//Casa 11 - Companhia de eletricidade 150


	//Casa 12
	strcpy(propriedades[12].nome, "Rua Ferreira Borges");
	propriedades[12].preço = 140;
	propriedades[12].hipoteca = 50;
	strcpy(propriedades[12].localizaçao, "Coimbra");
	strcpy(propriedades[12].proprietario, "Sem Proprietario");

	//Casa 13
	strcpy(propriedades[13].nome, "Avenida de Roma");
	propriedades[13].preço = 160;
	propriedades[13].hipoteca = 50;
	strcpy(propriedades[13].localizaçao, "Lisboa");
	strcpy(propriedades[13].proprietario, "Sem Proprietario");

	//Casa 14
	strcpy(propriedades[14].nome, "Gare do Oriente");
	propriedades[14].preço = 200;
	propriedades[14].hipoteca = 50;
	strcpy(propriedades[14].localizaçao, "Lisboa");
	strcpy(propriedades[14].proprietario, "Sem Proprietario");

	//Casa 15
	strcpy(propriedades[15].nome, "Avenida da Boavista");
	propriedades[15].preço = 180;
	propriedades[15].hipoteca = 50;
	strcpy(propriedades[15].localizaçao, "Porto");
	strcpy(propriedades[15].proprietario, "Sem Proprietario");
	
	//Casa 16 - Caixa da Comunidade


	//Casa 17
	strcpy(propriedades[17].nome, "Avenida da Republica");
	propriedades[17].preço = 180;
	propriedades[17].hipoteca = 50;
	strcpy(propriedades[17].localizaçao, "Lisboa");
	strcpy(propriedades[17].proprietario, "Sem Proprietario");

	//Casa 18
	strcpy(propriedades[18].nome, "Rua Mouzinho da Silveira");
	propriedades[18].preço = 200;
	propriedades[18].hipoteca = 50;
	strcpy(propriedades[18].localizaçao, "Porto");
	strcpy(propriedades[18].proprietario, "Sem Proprietario");

	//Casa 19 - Estacionamento Livre


	//Casa 20
	strcpy(propriedades[20].nome, "Rua de Santa Catarina");
	propriedades[20].preço = 220;
	propriedades[20].hipoteca = 50;
	strcpy(propriedades[20].localizaçao, "Porto");
	strcpy(propriedades[20].proprietario, "Sem Proprietario");

	//Casa 21 - Sorte


	//Casa 22
	strcpy(propriedades[22].nome, "Avenida Infante Santo");
	propriedades[22].preço = 220;
	propriedades[22].hipoteca = 50;
	strcpy(propriedades[22].localizaçao, "Lisboa");
	strcpy(propriedades[22].proprietario, "Sem Proprietario");

	//Casa 23
	strcpy(propriedades[23].nome, "Rua Julio Diniz");
	propriedades[23].preço = 240;
	propriedades[23].hipoteca = 50;
	strcpy(propriedades[23].localizaçao, "Porto");
	strcpy(propriedades[23].proprietario, "Sem Proprietario");

	//Casa 24
	strcpy(propriedades[24].nome, "Estacao de S. Bento");
	propriedades[24].preço = 200;
	propriedades[24].hipoteca = 50;
	strcpy(propriedades[24].localizaçao, "Porto");
	strcpy(propriedades[24].proprietario, "Sem Proprietario");

	//Casa 25
	strcpy(propriedades[25].nome, "Praca da Republica");
	propriedades[25].preço = 260;
	propriedades[25].hipoteca = 50;
	strcpy(propriedades[25].localizaçao, "Porto");
	strcpy(propriedades[25].proprietario, "Sem Proprietario");

	//Casa 26
	strcpy(propriedades[26].nome, "Avenida Fontes Pereira de Melo");
	propriedades[26].preço = 260;
	propriedades[26].hipoteca = 50;
	strcpy(propriedades[26].localizaçao, "Lisboa");
	strcpy(propriedades[26].proprietario, "Sem Proprietario");

	//Casa 27 - Companhia das Águas


	//Casa 28
	strcpy(propriedades[28].nome, "Rotunda da Boavista");
	propriedades[28].preço = 280;
	propriedades[28].hipoteca = 50;
	strcpy(propriedades[28].localizaçao, "Porto");
	strcpy(propriedades[28].proprietario, "Sem Proprietario");


	//Casa 29 - Vá para a cadeia


	//Casa 30
	strcpy(propriedades[30].nome, "Avenida da Liberdade");
	propriedades[30].preço = 300;
	propriedades[30].hipoteca = 50;
	strcpy(propriedades[30].localizaçao, "Lisboa");
	strcpy(propriedades[30].proprietario, "Sem Proprietario");

	//Casa 31
	strcpy(propriedades[31].nome, "Rua dos Clerigos");
	propriedades[31].preço = 300;
	propriedades[31].hipoteca = 50;
	strcpy(propriedades[31].localizaçao, "Porto");
	strcpy(propriedades[31].proprietario, "Sem Proprietario");

	//Casa 32 - Caixa da comunidade


	//Casa 33
	strcpy(propriedades[33].nome, "Avenida do Parque das Nacoes");
	propriedades[33].preço = 320;
	propriedades[33].hipoteca = 50;
	strcpy(propriedades[33].localizaçao, "Lisboa");
	strcpy(propriedades[33].proprietario, "Sem Proprietario");

	//Casa 34
	strcpy(propriedades[34].nome, "Estacao de Santa Apolonia");
	propriedades[34].preço = 200;
	propriedades[34].hipoteca = 50;
	strcpy(propriedades[34].localizaçao, "Lisboa");
	strcpy(propriedades[34].proprietario, "Sem Proprietario");

	//Casa 35 - Sorte


	//Casa 36
	strcpy(propriedades[36].nome, "Rua das Amoreiras");
	propriedades[36].preço = 200;
	propriedades[36].hipoteca = 50;
	strcpy(propriedades[36].localizaçao, "Lisboa");
	strcpy(propriedades[36].proprietario, "Sem Proprietario");

	//Casa 37 - Imposto de Luxo


	//Casa38
	strcpy(propriedades[38].nome, "Rossio");
	propriedades[38].preço = 400;
	propriedades[38].hipoteca = 50;
	strcpy(propriedades[38].localizaçao, "Lisboa");
	strcpy(propriedades[38].proprietario, "Sem Proprietario");

	//Início do Jogo
	printf("= MONOPOLIO =\n");
	printf("Bem-vindo ao Monopolio para a Consola do Windows.\n");
	printf("Este jogo foi codificado em liguagem C no ambito da disciplina de\n");
	printf("Algoritmos e Estrutura de Dados, lecionada pelo professor Jose Carlos,\n");
	printf("UC da Licenciatura de Engenharia em Desenvolvimento de Jogos Digitais.\n");
	printf("\nAutores: Gil Ferraz (10660) e Teresa Loureiro (10661)\n");

	printf("\n== Selecao de Jogadores ==\n");
	int nJogadores = seleçãoJogadores();
	
	int turno = 10;
	//Execução de turnos
	do
	{
		printf("\n== Turno %d ==\n", turno);

		for (int i = 0; i < nJogadores; i++)
		{
			printf("\n=== Jogador %d - %s ===\n", i + 1, jogadores[i].nome);
			printf(" * Saldo = %d euros\n", jogadores[i].saldo);
			printf(" * Posicao = Casa %d - %s\n", jogadores[i].posição, propriedades[jogadores[i].posição].nome);

			//Escolha de opção
			int opção = 0;

			printf("\nO que que deseja fazer?\n");
			printf("1 - Lancar os dados\n");
			if (strcmp(propriedades[jogadores[i].posição].proprietario, "Sem Proprietario") == 0)
				printf("2 - Comprar propriedade\n");
			if (propriedades[jogadores[i].posição].proprietario == jogadores[i].nome)
			{
				printf("3 - Construir casa\n");
				printf("4 - Construir hotel\n");
			}
			scanf_s("%d", &opção);

			//Lançamento de dados e cálculo da nova posição do jogador
			int antigaPosição = jogadores[i].posição;
			
			jogadores[i].posição = novaPosicao(jogadores[i].posição, lançamentoDados());
			printf("\n== Movimentos ==\n");
			printf(" * Posicao = Casa %d - %s\n", jogadores[i].posição, propriedades[jogadores[i].posição].nome);

			//Detalhes da casa em que o jogador se encontra
			printf("\n== %s ==\n", propriedades[jogadores[i].posição].nome);
			printf(" * Preco: %d\n", propriedades[jogadores[i].posição].preço);
			printf(" * Hipoteca: %d\n", propriedades[jogadores[i].posição].hipoteca);
			printf(" * Localizacao: %s\n", propriedades[jogadores[i].posição].localizaçao);


			//Verficar se o jogador se encontra ou passou pela Casa de Partida
			if ((jogadores[i].posição == 0) || (jogadores[i].posição < antigaPosição))
			{
				printf("\n Passou pelo casa Partida. Recebe 200 euros.\n");
				jogadores[i].saldo += 200;
				printf(" * Saldo = %d euros\n", jogadores[i].saldo);
			}
			printf("\n\n\n");
		}
	} while (turno != 100);

	system("pause");
}
